---
  - hosts: redhat
    become: yes
    remote_user: sysadmin
    roles:
      - initialconf
      - podman  
      - apache  
 
    tasks:
   
    - name: Copy virtualhost configuration
      copy:
        src: ./files/vhost.conf
        dest: /etc/httpd/vhosts.d/vhost.conf
      notify: Restart apache
    
    - name: Create container
      containers.podman.podman_container:
        name: todoapp
        image: todoapp
        network: host
        state: started
   
    - name: Open firewall port
      firewalld:
        port: 8080/tcp
        state: enabled 
        permanent: true
        immediate: true

    handlers:
 
     - name: Restart apache
       service:
         name: httpd
         state: restarted
